<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-development/touchgfx-hal-development/touchgfx-generator">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/touchgfx-test.github.io/zh-CN/opensearch.xml">
<script src="/touchgfx-test.github.io/zh-CN/js/OneTrust.js"></script>
<script defer="defer" src="https://assets.adobedtm.com/a86419113799/01b0e221c0d2/launch-b2e52930cd27-development.min.js"></script>
<script src="/4.20/js/fix-location.js"></script><title data-rh="true">Generator用户指南 | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/touchgfx-test.github.io/zh-CN/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/touchgfx-test.github.io/zh-CN/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Generator用户指南 | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/touchgfx-test.github.io/zh-CN/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/touchgfx-test.github.io/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/touchgfx-test.github.io/ko/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/touchgfx-test.github.io/ja/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/touchgfx-test.github.io/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/touchgfx-test.github.io/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/touchgfx-test.github.io/zh-CN/assets/css/styles.a3789d89.css">
<link rel="preload" href="/touchgfx-test.github.io/zh-CN/assets/js/runtime~main.f5988e44.js" as="script">
<link rel="preload" href="/touchgfx-test.github.io/zh-CN/assets/js/main.d8385bca.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">跳转到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/touchgfx-test.github.io/zh-CN/docs/introduction/welcome"><div class="navbar__logo"><img src="/touchgfx-test.github.io/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/touchgfx-test.github.io/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">简体中文</a><ul class="dropdown__menu"><li><a href="/touchgfx-test.github.io/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/touchgfx-test.github.io/ko/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/touchgfx-test.github.io/ja/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">简体中文</a></li><li><a href="/touchgfx-test.github.io/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/touchgfx-test.github.io/zh-CN/docs/introduction/welcome">4.20</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator">4.20</a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">社区</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><div class="searchBox_Gz_y"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/touchgfx-test.github.io/zh-CN/docs/category/introduction">介绍</a><button aria-label="Toggle the collapsible sidebar category &#x27;介绍&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/touchgfx-test.github.io/zh-CN/docs/category/basic-concepts">基本概念</a><button aria-label="Toggle the collapsible sidebar category &#x27;基本概念&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/touchgfx-test.github.io/zh-CN/docs/development/development-introduction">开发</a><button aria-label="Toggle the collapsible sidebar category &#x27;开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/development/hardware-selection/hardware-selection-introduction">硬件选择</a><button aria-label="Toggle the collapsible sidebar category &#x27;硬件选择&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/development/board-bring-up/board-introduction">驱动板卡</a><button aria-label="Toggle the collapsible sidebar category &#x27;驱动板卡&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">TouchGFX AL开发</a><button aria-label="Toggle the collapsible sidebar category &#x27;TouchGFX AL开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-architecture">抽象层架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator">Generator用户指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/category/scenarios">场景</a><button aria-label="Toggle the collapsible sidebar category &#x27;场景&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/development/ui-development/ui-development-introduction">UI开发</a><button aria-label="Toggle the collapsible sidebar category &#x27;UI开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/touchgfx-test.github.io/zh-CN/docs/category/scenarios-2">场景</a><button aria-label="Toggle the collapsible sidebar category &#x27;场景&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/touchgfx-test.github.io/zh-CN/docs/category/miscellaneous-1">其他情况</a><button aria-label="Toggle the collapsible sidebar category &#x27;其他情况&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/touchgfx-test.github.io/zh-CN/docs/category/tutorials">指导</a><button aria-label="Toggle the collapsible sidebar category &#x27;指导&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/touchgfx-test.github.io/zh-CN/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/touchgfx-test.github.io/zh-CN/docs/category/resources">资源</a><button aria-label="Toggle the collapsible sidebar category &#x27;资源&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/touchgfx-test.github.io/zh-CN/docs/development/development-introduction"><span itemprop="name">开发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction"><span itemprop="name">TouchGFX AL开发</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Generator用户指南</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">在当前页面</button></div><div class="theme-doc-markdown markdown"><header><h1>Generator用户指南</h1></header><p>TouchGFX Generator是X-CUBE-TOUCHGFX的一部分，也是STM32CubeMX附加软件组件，可帮助开发人员配置TouchGFX并运行于他的硬件平台上。 根据已有的STM32CubeMX设置和用户输入，TouchGFX Generator将生成TouchGFX应用所需的有效配置文件 这包括TouchGFX HAL、TouchGFX OSAL和TouchGFX配置文件。</p><p>通过STM32CubeMX生成代码后，可通过TouchGFX Designer打开TouchGFX项目，并进行UI开发。 TouchGFX Designer会自动将任何额外生成的代码文件添加到通过STM32CubeMX所配置的目标IDE工程。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-touchgfx-generator">使能TouchGFX Generator<a class="hash-link" href="#enabling-touchgfx-generator" title="直接链接到标题">​</a></h2><p>用户可通过按“选择组件”按钮来访问X-CUBE的附加功能。</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/enable-generator.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/enable-generator.png"></a><p>选择STM32CubeMX中的附加软件</p></div><p>下图显示了项目中如何使能TouchGFX Generator：</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/add-generator-v4.17.png" target="_blank"><img width="580" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/add-generator-v4.17.png"></a><p>使能TouchGFX Generator</p></div><p>如果为双核MCU启用TouchGFX，请确保为正确的上下文启用。 TouchGFX只能为单一上下文启用：</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/add-generator-dual-core-v4.17.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/add-generator-dual-core-v4.17.png"></a><p>在双核心芯片上使用TouchGFX Generator</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-code-architecture">生成的代码架构<a class="hash-link" href="#generated-code-architecture" title="直接链接到标题">​</a></h2><p>在描述TouchGFX Generator的功能之前，了解所生成代码的架构以及开发人员如何使用该架构来定制配置和行为至关重要。</p><p>在STM32CubeMX生成的代码（C代码）中，<strong>User Code</strong>段内的用户手写代码，会受到STM32CubeMX保护。 在TouchGFX Generator生成的C++代码中，通过继承来实现这种灵活性。</p><p>通过<em>Additional Software</em>添加TouchGFX Generator并使能后，STM32CubeMX总是会为项目创建一个<em>TouchGFX</em>文件夹。 无论配置如何，该文件夹总是包含相同的文件，而文件内容则因STM32CubeMX和用户配置而异。</p><p>以下列表概述了<em>使能</em>TouchGFX Generator的STM32CubeMX项目内容，并重点介绍与TouchGFX有关的文件。 下面按列表概述了最重要条目的功能。</p><div class="code-header"><div><h5>TouchGFX Folder</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   .mxproject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   myproject.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Drivers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───EWARM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Middlewares</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└───TouchGFX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ApplicationTemplate.touchgfx.part</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├───App</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └───target</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXGPIO.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        └───generated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                OSWrappers.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXConfiguration.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.hpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>文件夹</th><th>职责</th></tr></thead><tbody><tr><td>myproject.ioc</td><td>STM32CubeMX项目文件</td></tr><tr><td>内核</td><td><code>main.c</code>和启动代码</td></tr><tr><td>驱动</td><td>CMSIS和MCU系列驱动程序</td></tr><tr><td>EWARM</td><td>IDE项目文件夹。 可以为EWARM、MDK-ARM或STM32CubeIDE</td></tr><tr><td>中间件</td><td>包含TouchGFX库/头文件以及FreeRTOS等第三方软件。</td></tr><tr><td>ApplicationTemplate.touchgfx.part</td><td>STM32CubeMX使用与TouchGFX Designer项目相关的信息（如屏幕尺寸和位深）来更新.part文件</td></tr><tr><td>应用</td><td>STM32CubeMX的X-CUBE接口。  <code>app_touchgfx.c</code>文件包含<code>MX_TouchGFX_Process(void)</code>和<code>MX_TouchGFX_Init(void)</code>函数的定义，这些函数用于初始化TouchGFX和启动其主循环。</td></tr><tr><td>目标/生成</td><td>该子文件夹包含只读文件，当配置更改时，这些文件会被STM32CubeMX覆盖。 <code>TouchGFXGeneratedHAL.cpp</code>是TouchGFX类<code>HAL</code>的子类，并包含STM32CubeMX可基于其当前配置生成的代码。 <code>OSWrappers.cpp</code>(OSAL) 包含与TouchGFX Engine同步所需的功能，最后是<code>TouchGFXConfiguration.cpp</code>，其包含用于构建和配置TouchGFX的代码，包括HAL。</td></tr><tr><td>目标</td><td>包含大量文件，用户可修改这些文件，以扩展HAL行为，或覆盖STM32CubeMX生成的配置。 <code>STM32TouchController.cpp</code>包含触摸控制器操作的空接口。 <code>TouchGFXHAL.cpp</code>定义<code>TouchGFXGeneratedHAL</code>的子类<code>TouchGFXHAL</code>。</td></tr></tbody></table><p>需要注意的是，<code>TouchGFXConfiguration.cpp</code>包含一个用于构建HAL的函数以及一个用于启动TouchGFX主循环的函数。 可在可编辑的用户类<code>TouchGFXHAL</code>中完成其他配置。 HAL的一般架构如下所示：</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/code-architecture.png" target="_blank"><img width="200" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/code-architecture.png"></a><p>生成的代码的层次结构</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-overview">特性概述<a class="hash-link" href="#feature-overview" title="直接链接到标题">​</a></h2><p>Having enabled TouchGFX Generator, three main groups exist in the user interface. A fourth, &quot;Dependencies&quot;, will appear if a problem with the current configuration is detected.</p><ul><li><strong><em>依赖关系</em></strong>- 该组包含针对开关人员的有关配置中的依赖关系、警告或具体错误的通知。 如果没有条目，则该组将隐藏。</li><li><strong><em>显示</em></strong>- 该组包含与显示有关的设置，如接口、帧缓存的位深、宽度和高度。 这些设置直接影响TouchGFX项目里画布的大小以及基于显示部件所生成的代码。</li><li><strong><em>Driver</em></strong> - This group allows the user to opt-in for a number of ready-made drivers related to the tick source of the application, graphics acceleration (DMA2D and GPU2D) and RTOS. 由于STM32CubeMX支持FreeRTOS（CMSIS RTOS v1和v2）配置，TouchGFX Generator为每个选项提供了驱动程序。</li><li><strong><em>Additional Features</em></strong> - This group appears if RGB565 is selected, allowing the user to create am application using image- and font-data from non-memory mapped flash.</li><li><strong>视频解码</strong> - 该组允许用户启用硬件或软件视频解码。 该选项对于视频控件是必要的。 注意！不是所有的MCU都支持视频解码。</li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/four-sections.png" target="_blank"><img width="600" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/four-sections.png"></a><p>TouchGFX Generator has three groups: Display, Driver and Video Decoding</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="display">显示<a class="hash-link" href="#display" title="直接链接到标题">​</a></h2><p><em>显示</em>组包含与显示有关的配置，如接口、尺寸和缓冲策略。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interface-and-dimensions">接口与尺寸<a class="hash-link" href="#interface-and-dimensions" title="直接链接到标题">​</a></h3><p>如今，STM32微控制器可使用多个显示接口，如：</p><ul><li>并行RGB（LTDC）</li><li>MIPI DSI</li><li>FMC</li><li>SPI</li></ul><p>如果MCU带有连接到LTDC或FMC的显示器，<em>TouchGFX Generator</em>可生成代码，以将帧缓冲器传输到连接的显示器。 对于DSI和SPI接口，驱动程序必须由开发人员自己实现。</p><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">有关不同显示接口的代码具体例程，请参见<a href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb">方案</a>章节。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="framebuffer-pixel-format">帧缓冲像素格式<a class="hash-link" href="#framebuffer-pixel-format" title="直接链接到标题">​</a></h3><p>TouchGFX Generator目前支持以下帧缓冲像素格式。 当使用“Custom”显示接口时，所有选项均可用，否则选项被限制为显示控制器设置（例如，配置LTDC Framebuffer格式为“RGB565”时，会将TouchGFX Generator中的配置选项限制为“RGB565”）。</p><ol><li>BW (1bpp)</li><li>Grey2 (2bpp)</li><li>Grey4 (4bpp)</li><li>ABRG2222 (8bpp)</li><li>ARGB2222 (8bpp)</li><li>BGRA2222 (8bpp)</li><li>RGBA2222 (8bpp)</li><li>RGB565 (16bpp)</li><li>RGB888 (24bpp)</li><li>ARGB8888 (32bpp)</li><li>XRGB8888 (32bpp)</li></ol><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">一些像素格式没有或仅有部分ChromART（DMA2D）支持。</div></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content"><b>For STM32F7/H7</b>: If the framebuffer is placed in Write Through cached memory (e.g. SRAM) then the DCache is flushed by the generated code prior to DMA2D (if configured in the Generator) accessing it. 记住要在STM32CubeMX中的<b>Cortex M7</b>的<b>System Core</b>设置中启用<b>CPU Cache</b>，这样缓存机制才能正常工作。</div></div><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">如需更多关于CPU缓存的详细信息，请参阅<a href="/touchgfx-test.github.io/zh-CN/docs/development/board-bring-up/how-to/02-cpu-running#cache-on-f7-and-h7">F7和H7</a>中的“Cache（缓存）”章节。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffering-strategies">缓冲策略<a class="hash-link" href="#buffering-strategies" title="直接链接到标题">​</a></h3><p>可通过TouchGFX Generator配置以下帧缓冲策略：</p><ul><li><strong>单帧缓冲</strong> - 仅使用一个应用帧缓冲区。 可能会使性能受限，但占用内存更少。 可与“缓冲位置”配置一起使用，将其放置在内部RAM中。 为进一步优化，用户可以定义一个函数，该函数返回显示控制器正在处理的当前行。 该方法用于框架，以允许更新该帧期间已传输到显示屏的内存。</li><li><strong>双缓冲</strong> - 使用两个帧缓冲区。 通常以牺牲内存为代价来获得更好的性能。</li><li><strong>部分缓冲</strong>- 将一个或多个用户定义的内存块作为帧缓冲区。 该策略适用于低成本解决方案，它不依赖外部RAM但可以实现超出可用内存的全帧缓冲能力。</li></ul><p>对于单缓冲区和双缓冲区，用户可通过“缓冲器位置”来配置其位置，该配置提供以下选项：</p><ul><li><strong>按分配</strong>- 允许链接器根据链接器脚本来放置帧缓冲存储器。 默认位于内部RAM中。</li><li><strong>按地址</strong>- 允许用户定义一个(单) 或两个(双) 帧缓冲地址。</li></ul><p><strong>部分帧缓冲</strong>策略允许用户定义以下参数:</p><ul><li>块数（始终放置在内部RAM中）</li><li>块大小（字节）</li></ul><p>要了解有关部分缓冲战略的一些核心概念，请阅读使用部分帧缓冲区降低内存要求的<a href="/touchgfx-test.github.io/zh-CN/docs/development/scenarios/lowering-memory-usage-with-partial-framebuffer">专用文章</a>。 本文从概念上说明了如何实现部分帧缓冲，并且本文中显示的代码与TouchGFX Generator生成的代码略有不同。 有关为这些策略生成的具体示例代码，请参见<a href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-framebuffer-strategies">帧缓冲策略</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="driver">驱动器<a class="hash-link" href="#driver" title="直接链接到标题">​</a></h2><p>驱动器部分允许开发人员为TouchGFX AL的各种功能选择驱动程序。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-tick-source">应用滴答计时源<a class="hash-link" href="#application-tick-source" title="直接链接到标题">​</a></h3><p>滴答计时源定义了如何展开驱动应用程序的开发。 开发人员具有以下选项：</p><ul><li><strong>LTDC</strong>-如果在“Display”组中选用LTDC接口，则应用Tick源可以选“LTDC”。 这意味着TouchGFX Generator将在<code>TouchGFXGenerated HAL</code>类中安装驱动程序函数(LTDC中断处理程序) ，该函数通过调用<code>OSWrappers::signalVSync()</code>来展开驱动应用程序。</li><li><strong>Custom和FMC</strong> - 在这种情况下，开发人员需要通过周期性调用<code>OSWrappers::signalVSync()</code>来驱动应用程序的执行。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphics-accelerator">图形加速器<a class="hash-link" href="#graphics-accelerator" title="直接链接到标题">​</a></h3><p>对于图形加速，开发人员有三个选项：</p><ul><li><strong>None</strong> - The application renders using only the CPU.</li><li><strong>DMA2D Accelerator (ChromART)</strong> - The application uses the ChromART chip when possible to move and blend pixels, freeing up CPU cycles. The driver is generated by TouchGFX Generator and does not require any action from the developer.</li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-dma2d.png" target="_blank"><img width="200" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-dma2d.png"></a><p>DMA2D is enabled in the *Multimedia* category in CubeMX, for MCUS that support it.</p></div>1. 使用STM32Cube HAL驱动程序，其将回调函数注册到dma2d句柄`hdma2d.XferCpltCallback`。 2. 直接使用`DMA2D_IRQHandler()`中断处理程序。<p>通过在STM32CubeMX中DMA2D IP的NVIC设置中启用或禁用DMA2D全局中断，可以在这两者之间进行切换。 选项1）启用全局中断生成的代码，选项2）禁用全局中断生成的代码。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>When using global interrupt for DMA2D, ensure that the &quot;IRQ handler&quot; calls the &quot;DMA2D HAL handler&quot;. This is default behaviour.</li><li>如果在启用全局中断的同时禁用DMA2D的“ IRQ中断服务程序”和“调用HAL中断处理程序”，将导致永不调用已注册的回调。</li></div></div><ul><li><strong>GPU2D (NeoChrom)</strong> is a graphics accelerator capable of accelerating many of the drawing operations in TouchGFX, including texture mapping. It supports framebuffers in RGB565, RGB888, and ARGB8888 formats.</li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-gpu2d.png" target="_blank"><img width="190" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-gpu2d.png"></a><p>GPU2D is enabled in the *Multimedia* category in CubeMX, for MCUS that support it.</p></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content">The GPU2D option is only visible if GPU2D has been enabled in the <i>Multimedia</i> section for your project in CubeMX. It is only available for STM32U599 devices and can only be enabled for use with TouchGFX if the ThreadX RTOS from the <i>Middlewares</i> section is also enabled.</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-time-operating-system">实时操作系统<a class="hash-link" href="#real-time-operating-system" title="直接链接到标题">​</a></h3><p>开发人员可使用任何支持TouchGFX的RTOS（甚至无操作系统）。 如抽象层架构中所述，TouchGFX Engine使用<code>OSWrappers</code>接口将其主事件循环以及帧缓冲访问与用户选择的RTOS同步。 When developers choose an operating system in TouchGFX Generator, code will be generated to syncronize internally via primitives for the OS of choice. 操作系统仍然必须通过STM32CubeMX进行配置，以确定堆栈大小等。</p><p>FreeRTOS (CMSIS OS V1 and V2) and ThreadX (Native Middleware or Azure RTOS Software Packs) can be configured directly from within STM32CubeMX and TouchGFX Generator providing the user with generated code for both task definitions and TouchGFX RTOS driver. TouchGFX Generator can generate CMSIS V1 and CMSIS V2 compliant RTOS drivers which work with any CMSIS compliant RTOS, a driver for ThreadX, and a driver for running bare metal without an operating system.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="threadx-middleware-os">ThreadX<a class="hash-link" href="#threadx-middleware-os" title="直接链接到标题">​</a></h4><p>ThreadX can be enabled either by selecting an AZRTOS Software Pack or by enabling the Native ThreadX Middleware from STM32CubeMX, if available for the selected MCU device.</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>All new STM32 MCU devices will support, by default, ThreadX Middleware directly available from STM32CubeMX without requiring additional pack downloads. TouchGFX Board Support packs will slowly transition to using either ThreadX middleware, where available, or X-CUBE-AZRTOS software packs.</li><li>X-CUBE-AZRTOS-XX Expansion Packs providing ThreadX support are already available for the <i>STM32G0xx, STM32G4xx, STM32L4xx, STM32F4xx, STM32F7xx</i> and the <i>STM32H7xx</i> MCU Series.</li></div></div><p>下图显示了TouchGFX Generator中可用的选项。</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options-threadx.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options-threadx.png"></a><p>RTOS驱动程序选项</p></div><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li><b><i>NoOS</i></b> option is disabled when <b>ThreadX</b> Middleware is enabled.</li><li><b><i>CMSIS_RTOS_V1</i></b> and <b><i>CMSIS_RTOS_V2</i></b> options are disabled when <b>ThreadX</b> Middleware is enabled. CMSIS OS wrapper is not provided by ST, customer has to select <b><i>Custom</i></b> option and implement the CMSIS wrapper.</li></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-and-configuring-threadx-from-the-middleware-list-available-in-stm32cubemx">Enabling and configuring ThreadX from the Middleware list available in STM32CubeMX<a class="hash-link" href="#enabling-and-configuring-threadx-from-the-middleware-list-available-in-stm32cubemx" title="直接链接到标题">​</a></h5><p>A succesful memory configuration for ThreadX relies on <i>Memory Pool Allocation</i>. The recommended value is <i>Static Allocation</i>. Perform the folowing steps in the ThreadX Middleware configuration:</p><ul><li>Enable <code>THREADX</code> Middleware by selecting <code>Core</code> from the Mode list, as seen in the figure below.</li><li>Set <code>TX_TIMER_TICKS_PER_SECOND</code> to <strong>1000</strong> to get Ticks each one millisecond</li><li>Set <code>Memory Pool Allocation</code> to <strong>Use Static Allocation</strong></li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/enable-and-configure-native-threadx-mw.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/enable-and-configure-native-threadx-mw.png"></a><p>Enabling and Configuring Native ThreadX Middleware</p></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content"><li><b>Memory Pool Allocation</b> should be set to <b>Use Dynamic Allocation</b> when <b>Native ThreadX Middleware</b> is enabled</li><ul><li>When <b>Memory Pool Allocation</b> is set to <b>Use Dynamic Allocation</b></li><ul><li>User will have to add the missing code in the <i>USER CODE BEGIN DYNAMIC_MEM_ALLOC</i> section in the generated <b><i>app_azure_rtos.c</i></b> file.</li><li>User will need also to update the linker files following the recemmendation described in the generated <b><i>app_azure_rtos.c</i></b> file.</li></ul></ul></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-and-configuring-threadx-from-azrtos-software-pack">Enabling and configuring ThreadX from AZRTOS Software Pack<a class="hash-link" href="#enabling-and-configuring-threadx-from-azrtos-software-pack" title="直接链接到标题">​</a></h5><ul><li>Select <strong>Software Packs -&gt; Select Components</strong> or Press <code>Alt-O</code>.</li><li>Select <strong>STMicroelectonics.X-CUBE-AZRTOS-XX</strong>. Download the pack if required.</li><li>Select <strong>RTOS ThreadX</strong> and check the <strong>Core</strong> check box to enable ThreadX. You can now safely close the <i>Software Packs Component Selector</i>.</li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos.png"></a><p>Enabling ThreadX from an X-CUBE-AZRTOS Software Pack</p></div><ul><li>Select the <i>Software Packs</i> group from the <i>Categories</i> list on the left hand side and select <strong>STMicroelectonics.X-CUBE-AZRTOS-XX</strong></li><li>Enable ThreadX by selecting the mode <strong>RTOS ThreadX</strong></li><li>Set <code>Memory Pool Allocation</code> to <strong>Use Static Allocation</strong></li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config1.png" target="_blank"><img width="800" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config1.png"></a><p>ThreadX Configuration - X-CUBE-AZRTOS Software Pack</p></div><ul><li>Set <code>TX_TIMER_TICKS_PER_SECOND</code> to <strong>1000</strong> to get ticks once per millisecond.</li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config2.png" target="_blank"><img width="800" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config2.png"></a><p>ThreadX Configuration - X-CUBE-AZRTOS Software Pack</p></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="freertos-middleware-os">FreeRTOS<a class="hash-link" href="#freertos-middleware-os" title="直接链接到标题">​</a></h4><p>调用以下函数时，将进入TouchGFX主循环。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开发人员需要在任务处理程序中为要在其中运行TouchGFX应用程序的任务调用此函数。 如果用户从STM32CubeMX配置了名为<code>DefaultTask</code>的FeeRTOS任务，则以下示例显示了如何在用户代码中，通过任务处理函数调用 <code>MX_TouchGFX_Process() </code>函数来启动TouchGFX任务。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">StartDefaultTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argument</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN 5 */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END 5 */</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>STM32CubeMX will also generate a call to <code>osKernelStart();</code> which starts the scheduler.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="threadx-middleware-os">ThreadX Middleware<a class="hash-link" href="#threadx-middleware-os" title="直接链接到标题">​</a></h4><p>STM32CubeMX is no more responsible of generating the code creating the threads for middlewares and for the user.<br> STM32CubeMX will generate the call to the <code>MX_TouchGFX_PreOSInit()</code> function which will initialize the TouchGFX framework<br> STM32CubeMX will generate the call to the <code>MX_ThreadX_Init()()</code> function which will initialize and start the ThreadX kernel</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Call PreOsInit function */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_PreOSInit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN 2 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END 2 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_ThreadX_Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TouchGFX Generator will generate the <code>MX_TouchGFX_PreOSInit()</code> function which will simply call the <code>touchgfx_init()</code></p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * PreOS Initialization function</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_PreOSInit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Calling forward to touchgfx_init in C++ domain</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">touchgfx_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TouchGFX Generator will generate the <code>MX_TouchGFX_Init()</code> function which will create the TouchGFX thread</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * Create TouchGFX Thread</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UINT </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">memory_ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  UINT ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CHAR </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">pointer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Allocate the stack for TouchGFX Thread.  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">tx_byte_allocate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TX_BYTE_POOL</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">memory_ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">pointer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                       TOUCHGFX_STACK_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_NO_WAIT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TX_POOL_ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Create TouchGFX Thread */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">tx_thread_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">TouchGFXThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CHAR </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TouchGFX&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TouchGFX_Task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                       pointer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TOUCHGFX_STACK_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                       </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                       TX_NO_TIME_SLICE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_AUTO_START</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TX_THREAD_ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TouchGFX Generator will generate the required code which will be inserted by STM32CubeMX into the file <b><i>app_azure_rtos.c</i></b></p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @brief  Define the initial system.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param  first_unused_memory : Pointer to the first unused memory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @retval None</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">VOID </span><span class="token function" style="color:rgb(130, 170, 255)">tx_application_define</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">first_unused_memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">tx_byte_pool_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">touchgfx_app_byte_pool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TouchGFX App memory pool&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> touchgfx_byte_pool_buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TOUCHGFX_APP_MEM_POOL_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN TouchGFX_Byte_Pool_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END TouchGFX_Byte_Pool_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN TouchGFX_Byte_Pool_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END TouchGFX_Byte_Pool_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory_ptr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">touchgfx_app_byte_pool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">memory_ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN  MX_X-CUBE-TOUCHGFX_Init_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END  MX_X-CUBE-TOUCHGFX_Init_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN  MX_X-CUBE-TOUCHGFX_Init_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END  MX_X-CUBE-TOUCHGFX_Init_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>tx_application_define()</code> function is called by the ThreadX kernel at initialization time.<br> The <code>MX_TouchGFX_Init()</code> function is called by <code>tx_application_define()</code>.<br> The TouchGFX thread will be started later when the ThreadX kernel is started.</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>STM32CubeMX generate full code only the <b>Static Memory Pool Allocation</b> configuration for the <b>ThreadX Middlewares</b>.</li><li>Please refer to the <i>STM32H7B3I-DK/Applications/AnimatedImages</i> example available inside the <b>X-CUBE-TOUCHGFX</b> expansion pack if you want to configure ThreadX with <b>Dynamic Memory Allocation</b></li></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-cmsis-compliant-os">其他兼容CMSIS的OS<a class="hash-link" href="#other-cmsis-compliant-os" title="直接链接到标题">​</a></h4><p>当开发人员采用与STM32CubeMX提供的操作系统（FreeRTOS和ThreadX）不同的，兼容CMSIS的其他操作系统时，他必须手动完成RTOS配置和任务定义。 通常，需要执行以下手动步骤：</p><ol><li>配置RTOS</li><li>定义任务以运行TouchGFX (<code>MX_TouchGFX_Process</code>)</li><li>启动调度器</li></ol><p>调用<code>MX_TouchGFX_Process</code>，以启动任务处理程序中的TouchGFX Engine主循环。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-features">其它功能<a class="hash-link" href="#additional-features" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-data-reader">外部数据读取器<a class="hash-link" href="#external-data-reader" title="直接链接到标题">​</a></h4><p>对于RGB565帧缓冲像素格式，touchgfx支持所谓的<em>数据读取器</em>接口，该接口使开发人员能够直接从非存储器映射串行闪存读取数据，而无需进行<a href="/touchgfx-test.github.io/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps">缓存</a>，当然这需要增加额外的缓冲存储区。 有关如何实现DataReader，从非存储映射闪存芯片中获取应用程序资源的示例，请参见<a href="/touchgfx-test.github.io/zh-CN/docs/development/scenarios/using-serial-flash">SerialFlash</a>文章。</p><p><em>数据读取器</em>选项通常用于没有足够的内存用于额外缓冲区的低成本解决方案(如STM32G0) 。 如果DMA2D使能了，则无法使能该选项。</p><p>一旦<em>RGB565</em>选作帧缓冲像素格式后，<em>附加功能</em>组将变得可用。</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.png" target="_blank"><img width="520" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.png"></a><p>其它功能：数据读取器</p></div><p>开发人员可进行以下配置：</p><ul><li><strong>外部数据读取器：</strong>使能或禁用功能。 如果使能，TouchGFX将直接通过生成的接口检索应用资源。 如果禁用，则开发人员需要将图片资源<em>缓存</em>到内存缓冲区中。</li><li><strong>外部数据读取器：行缓冲区大小：</strong>创建两个缓冲区，以便将图像或文本混合到帧缓冲中。 默认值为一个屏幕宽度*4字节，以支持ARGB8888像素格式的全尺寸图像。</li><li><strong>外部数据读取器：最小DMA传输大小：</strong>设置启动DMA传输所需的最小字节。 如果请求传输的字节更少，将不使用DMA。</li></ul><p>在使能<em>外部数据读取器</em>的情况下生成代码后，将创建以下附加文件，以支持直接从非存储器映射闪存中检索图片资源。</p><ul><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.hpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.cpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.hpp</code></li></ul><p>像往常一样，对于TouchGFX Generator生成的代码，<code>TouchGFXGeneratedDataReader</code>为只读，用户修改应在<code>TouchGFXDataReader</code>类中进行。 <code>TouchGFXGeneratedDataReader</code>的类型为<code>touchgfx::FlashDataReader</code>。</p><p>将TouchGFX HAL配置为使用<code>DataReader</code>，并对以下文件进行修改。</p><ul><li><code>TouchGFX/target/generated/TouchGFXConfiguration.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.hpp</code></li></ul><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">仅当禁用DMA2D和LTDC时，DataReader附加功能才可用。</div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8bit-ltdc-color-look-up-table">8位LTDC颜色查询表<a class="hash-link" href="#8bit-ltdc-color-look-up-table" title="直接链接到标题">​</a></h4><p>当LTDC被配置为读取L8格式的帧缓冲器和TouchGFX渲染 <a href="/touchgfx-test.github.io/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___a_b_g_r2222">ABRG2222</a>、 <a href="/touchgfx-test.github.io/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___a_r_g_b2222">ARGB222</a>、 <a href="/touchgfx-test.github.io/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___b_g_r_a2222">BGRA2222</a>或 <a href="/touchgfx-test.github.io/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___r_g_b_a2222">RGBA2222</a>格式时, TouchGFX Generator将提供一个CLUT（在<code>TouchGFXHAL::initialize()</code>执行期间加载到LTDC）。 有关LTDC和CLUT的用法，详见STM32 MCU参考手册。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding">视频解码<a class="hash-link" href="#video-decoding" title="直接链接到标题">​</a></h2><p>‘视频解码’部分可让开发者通过硬件或软件视频解码能力增强TouchGFX HAL。</p><p>视频解码仅支持RGB565（16bpp）和RGB888（24bpp）格式的帧缓冲区。 如果没有选择这两种格式，则视频解码部分将不可用。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">不是所有MCU都支持硬件视频解码。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-type">类型<a class="hash-link" href="#video-decoding-type" title="直接链接到标题">​</a></h3><p>默认情况下，视频解码的”类型”是禁用的。 如果STM32CubeMX中没有启用所需的外设，“软件解码”和“硬件解码”都将显示为灰色。 将鼠标悬停在灰色的选项上，看看需要哪些外设。</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-dependecies-info-box.png" target="_blank"><img width="800" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-dependecies-info-box.png"></a><p>信息框显示“硬件解码”的视频类型依赖项</p></div><ul><li><strong>软件</strong> - 如果在STM32CubeMX的中间件部分启用了LIBJPEG，则可以选择“软件”选项，并生成软件解码器。 这意味着TouchGFX Generator将生成一个软件MJPEG解码器。</li><li><strong>硬件</strong> - 如果在多媒体部分启用了JPEG，并且在TouchGFX Generator中选择了符合CMSIS要求的RTOS，则可以选择“硬件”选项。</li></ul><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-options-4-18.png" target="_blank"><img width="800" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-options-4-18.png"></a><p>视频解码类型选项</p></div><p>在LIBJPEG设置中，为了提高效率，“RGB扫描线格式”中的RGB排序必须设置为“BGR”而不是“RGB”。 每个像素的字节数必须设置为3。</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/libjpeg-rgb-ordering.png" target="_blank"><img width="700" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/libjpeg-rgb-ordering.png"></a><p>需要的LIBJPEG RGB扫描线格式设置</p></div><p>使用硬件解码时，JPEG设置中的RGB格式必须与显示屏相同。</p><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">有关不同视频解码<a href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-video-decoding">场景</a>的具体示例代码，请参见“场景”部分。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-number">并发视频<a class="hash-link" href="#video-decoding-number" title="直接链接到标题">​</a></h3><p>“并发视频”选项可设置GUI中任意给定时间在同一屏幕上同时被解码的最大数量视频。 如果希望一块屏幕上只解码一个视频，则可以将“视频数量”设置为1。</p><p>最多可以同时解码4个视频。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-strategy">策略<a class="hash-link" href="#video-decoding-strategy" title="直接链接到标题">​</a></h3><p>关于视频解码策略，开发人员有三种选择。</p><ul><li><strong>“直接到帧缓存区（Direct to Framebuffer）”</strong> - 视频在UI线程中被解码。 解码速度慢于其他策略。 使用硬件视频解码时，“直接到帧缓存区（Direct to Framebuffer）”选项不可用。</li><li><strong>单缓冲区</strong> - 在专用的缓冲区中，以单独的任务进行视频解码。 该缓冲区位于内部存储器中。</li><li><strong>双缓冲区</strong> - 在两个专用缓冲区中，以单独的任务进行视频解码，以牺牲内存为代价获得更好的性能。</li></ul><p>采用单或双帧缓存区策略时，必须启用符合CMSIS要求的操作系统。</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-rtos-requirement-info-box.png" target="_blank"><img width="750" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-rtos-requirement-info-box.png"></a><p>关于CMSIS RTOS要求的信息框</p></div><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">使用双缓冲区策略时，要注意内存消耗。</div></div><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">关于配置用于视频解码的FreeRTOS的具体示例，请参见<a href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-video-decoding">“场景”</a>部分。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="decode-format">解码格式<a class="hash-link" href="#decode-format" title="直接链接到标题">​</a></h3><p>对于软件解码，开发人员可以选择RGB缓冲区的像素格式，不管帧缓存区的像素格式是什么。 TouchGFX Generator生成的代码允许ChromART在不同的格式之间进行像素格式转换。 视频解码缓冲区使用RGB565格式时，会使开发者占用的内存更少。</p><div class="figure noshadow"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-decode-format.png" target="_blank"><img width="700" src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-decode-format.png"></a><p>解码格式</p></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-buffer-size">缓存大小：<a class="hash-link" href="#video-decoding-buffer-size" title="直接链接到标题">​</a></h3><p>缓冲区的宽度和高度设置必须对应应用程序中的最大视频尺寸。 宽度值必须能被32整除。</p><p>以下代码是在<code>TouchGFXGeneratedHAL.cpp</code>中生成的代码，此应用中，使用了RGB888格式的显示屏，并使用480*272视频和“单缓冲区”视频解码策略。</p><div class="code-header"><div><h5>TouchGFXGeneratedHAL.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;DedicatedBufferVideoController.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;SoftwareMJPEGDecoder.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> lineBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SoftwareMJPEGDecoder </span><span class="token function" style="color:rgb(130, 170, 255)">mjpegdecoder1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">lineBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> videoRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">97920</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DedicatedBufferController</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">272</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">3U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Bitmap</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">RGB888</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Singleton Factory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">VideoController</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">VideoController</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXGeneratedHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">HAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">registerEventListener</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Application</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">setFrameBufferStartAddresses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">frameBuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">frameBuf </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">frameBuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     * Add software decoder to video controller</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">addDecoder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mjpegdecoder1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">videoRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">videoRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-project">生成的项目<a class="hash-link" href="#generated-project" title="直接链接到标题">​</a></h2><p>使用STM32CubeMX中的<strong>生成代码</strong>按钮生成代码时，TouchGFX（至少）适用于以下IDE：</p><ol><li>EWARM</li><li>MDK-ARM</li><li>STM32CubeIDE</li></ol><p>要获得最优项目结构，请选择以下项目生成选项：</p><ul><li>应用结构：<strong>高级</strong></li><li>禁用<strong>在根下生成</strong>(仅限STM32CubeIDE)</li></ul><div class="figure"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.png"></a><p>选择“高级应用结构”，然后取消选择“在根下生成”</p></div><p>STM32CubeMX还将生成具有以下结构的<em>TouchGFX</em>文件夹:</p><div class="figure"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.png"></a><p>TouchGFX文件夹结构</p></div><ul><li><em>应用</em>文件夹，包含用于初始化和启动TouchGFX的代码。</li><li><em>目标</em>文件夹，包含生成的只读代码(在内部生成) 和可更改的用户类(<code>STM32TouchController.cpp</code>、<code>TouchGFXGPIO.cpp</code>和<code>TouchGFXHAL.cpp</code>)</li><li><em>.part</em>文件，使用TouchGFX Designer来打开，以便创建完整的TouchGFX项目，其中包括TouchGFX头文件和库。part文件包含设计人员在生成TouchGFX应用程序代码时使用的相关程序信息，如像素格式和屏幕尺寸。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-designer-project">TouchGFX Designer项目<a class="hash-link" href="#touchgfx-designer-project" title="直接链接到标题">​</a></h2><p>The following json structure is an example of the contents of the <code>.part</code> file mentioned in the <a href="#generated-code-architecture">Generated Code Architecture</a> section for a project based on STM32U599. The post-generate command in the example below will update the project selected by the user in STM32CubeMX Project Manager tab (e.g. EWARM) with required libraries for TouchGFX and optional components as well as new files created by TouchGFX designer (e.g. new screens and assets).</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Application&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;STM32U599J-DK&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;TouchGfxPath&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../Middlewares/ST/touchgfx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;AvailableColorDepths&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;AvailableLCDs&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;24&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LCDGPU2D&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;AvailableResolutions&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;Width&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;Height&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;PostGenerateTargetCommand&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;touchgfx update_project&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Family&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;STM32U5&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;SubFamily&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;STM32U599/5A9&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Platform&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;m33&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;ProjectFile&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../STM32U599J-DK.ioc&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;OptionalComponentsRoot&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../Middlewares/ST/touchgfx_components&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;OptionalComponents&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GPU2D&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;4.19.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用TouchGFX Designer打开<em>.part</em>文件时，开发人员可以选择加载现存UI或从空白模板开始。</p><div class="figure"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui-4-17.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui-4-17.png"></a><p>选择UI</p></div><p>按下TouchGFX Designer中的<em>生成代码</em>后，TouchGFX文件夹的结构如下所示。 下图显示了TouchGFX文件夹结构的具体示例，并着重显示了生成后的新文件及文件夹。</p><div class="figure"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code-4-17.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code-4-17.png"></a><p>生成代码</p></div><div class="figure"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.png"></a><p>TouchGFX文件夹结构</p></div><p>TouchGFX将从.ioc STM32CubeMX文件（适用于STM32CubeIDE、EWARM、MDK-ARM）中检测所选的IDE，并使用新生成的文件（如用于屏幕定义、图像和字体的文件）来更新工程文件。</p><p>此时，开发人员可以切换使用STM32CubeMX、TouchGFX Designer和工具链/IDE，其中：</p><ul><li>STM32CubeMX可以更新IDE项目中的驱动程序</li><li>与UI相关的配置修改会由STM32CubeMX更新到TouchGFX<em> .part</em>文件，TouchGFX designer可以立即获取这些更改</li><li>STM32CubeMX基于TouchGFX在特定平台所需的TouchGFX Generator配置来生成HAL代码（TouchGFX/target/generated/）。</li><li>TouchGFX Designer使用生成的代码来更新项目。</li></ul><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">对于双核项目，为特定上下文启用TouchGFX，则TouchGFX项目通常会位于该上下文的专用文件夹中，例如:“CM4 / TouchGFX”或“CM7 / TouchGFX”。</div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-generated-behavior">修改生成文件<a class="hash-link" href="#modifying-generated-behavior" title="直接链接到标题">​</a></h2><p>需要注意的是，由于HAL的类层次结构，用户可以重写STM32CubeMX生成的HAL配置或操作。 在以下示例中，开发人员可以修改<code>初始化</code>函数，以额外配置TouchGFX，或修改<code>TouchGFXGeneratedHAL</code>中现有的配置集。</p><div class="code-header"><div><h5>TouchGFXHAL.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Calling parent implementation of initialize().</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 若要覆写生成的实现，请忽略对父函数的调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 并在此处实现所需的功能。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 请注意：必须调用HAL::initialize()以初始化框架。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXGeneratedHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//覆盖配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lockDMAToFrontPorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setFingerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-projects">升级项目<a class="hash-link" href="#upgrading-projects" title="直接链接到标题">​</a></h2><p>TouchGFX Generator参数存储在.ioc文件中（STM32CubeMX项目）。 当发布新版TouchGFX Generator时，旧版的参数可能与新版的参数不兼容，并可能需要移植。</p><p>由于STM32CubeMX不支持X-CUBE版本之间的升级，因此，TouchGFX Designer将会自动执行升级，通过<code>.touchgfx</code>文件的<code>PostGenerateTargetCommand</code>部分中的以下命令，在按下<em>生成代码</em>时来完成升级。</p><div class="code-header"><div><h5>.touchgfx</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;PostGenerateTargetCommand&quot; : &quot;touchgfx update_project --project-file=../upgrade.ioc --platform=m7&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该命令将读取<code>.ioc</code>文件并更新参数，以适应X-CUBE-TOUCHGFX的当前版本。 以下是通过X-CUBE-TOUCHGFX 4.13.0创建的.ioc文件上手动运行脚本（X-CUBE-TOUCHGFX 4.14.0）的示例。</p><div class="code-header"><div><h5>使用STM32F746 DISCO应用模板从4.13.0升级到4.14.0的示例</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ touchgfx update_project --project-file=../STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  TouchGFX Generator 4.13.0 found</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Creating backup of ../STM32F746G_DISCO.ioc as</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">../backup_STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Performing upgrade 4.13.0 -&gt; 4.14.0 ... OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用STM32CubeMX打开更新过的项目时，系统会提示用户安装由.ioc文件描述的X-CUBE-TOUCHGFX版本（如果尚未安装）。 点击<em>立即下载</em>后将下载并安装X-Cube-TouchGFX-4.14.0。</p><div class="figure"><a href="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.png" target="_blank"><img src="/touchgfx-test.github.io/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.png"></a><p>缺失的其他软件组件：TouchGFX Generator 4.14.0</p></div><p>升级期间将保留TouchGFX Generator中的所有配置，.ioc文件的备份文件将被放在原始文件旁，并带有前缀<code>backup_</code>。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">要使用TouchGFX Generator提供的新功能，必须在STM32CubeMX中执行<i>生成代码</i>。</div></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content">如果通过STM32CubeMX为现有的TouchGFX项目升级X-CUBE-TOUCHGFX，并且升级过程并非通过TouchGFX Designer来运行，则TouchGFX Generator参数将被重置为默认值，以适用于不同版本。</div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档页面导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/touchgfx-test.github.io/zh-CN/docs/development/touchgfx-hal-development/touchgfx-architecture"><div class="pagination-nav__sublabel">上一个</div><div class="pagination-nav__label">抽象层架构</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/touchgfx-test.github.io/zh-CN/docs/category/scenarios"><div class="pagination-nav__sublabel">下一个</div><div class="pagination-nav__label">Scenarios</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enabling-touchgfx-generator" class="table-of-contents__link toc-highlight">使能TouchGFX Generator</a></li><li><a href="#generated-code-architecture" class="table-of-contents__link toc-highlight">生成的代码架构</a></li><li><a href="#feature-overview" class="table-of-contents__link toc-highlight">特性概述</a></li><li><a href="#display" class="table-of-contents__link toc-highlight">显示</a><ul><li><a href="#interface-and-dimensions" class="table-of-contents__link toc-highlight">接口与尺寸</a></li><li><a href="#framebuffer-pixel-format" class="table-of-contents__link toc-highlight">帧缓冲像素格式</a></li><li><a href="#buffering-strategies" class="table-of-contents__link toc-highlight">缓冲策略</a></li></ul></li><li><a href="#driver" class="table-of-contents__link toc-highlight">驱动器</a><ul><li><a href="#application-tick-source" class="table-of-contents__link toc-highlight">应用滴答计时源</a></li><li><a href="#graphics-accelerator" class="table-of-contents__link toc-highlight">图形加速器</a></li><li><a href="#real-time-operating-system" class="table-of-contents__link toc-highlight">实时操作系统</a></li><li><a href="#additional-features" class="table-of-contents__link toc-highlight">其它功能</a></li></ul></li><li><a href="#video-decoding" class="table-of-contents__link toc-highlight">视频解码</a><ul><li><a href="#video-decoding-type" class="table-of-contents__link toc-highlight">类型</a></li><li><a href="#video-decoding-number" class="table-of-contents__link toc-highlight">并发视频</a></li><li><a href="#video-decoding-strategy" class="table-of-contents__link toc-highlight">策略</a></li><li><a href="#decode-format" class="table-of-contents__link toc-highlight">解码格式</a></li><li><a href="#video-decoding-buffer-size" class="table-of-contents__link toc-highlight">缓存大小：</a></li></ul></li><li><a href="#generated-project" class="table-of-contents__link toc-highlight">生成的项目</a></li><li><a href="#touchgfx-designer-project" class="table-of-contents__link toc-highlight">TouchGFX Designer项目</a></li><li><a href="#modifying-generated-behavior" class="table-of-contents__link toc-highlight">修改生成文件</a></li><li><a href="#upgrading-projects" class="table-of-contents__link toc-highlight">升级项目</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2022 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div></div>
<script src="/touchgfx-test.github.io/zh-CN/assets/js/runtime~main.f5988e44.js"></script>
<script src="/touchgfx-test.github.io/zh-CN/assets/js/main.d8385bca.js"></script>
</body>
</html>