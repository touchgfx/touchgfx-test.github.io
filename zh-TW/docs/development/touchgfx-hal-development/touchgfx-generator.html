<!doctype html>
<html lang="zh-TW" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-development/touchgfx-hal-development/touchgfx-generator">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.20/zh-TW/opensearch.xml">
<script src="/4.20/zh-TW/js/OneTrust.js"></script>
<script defer="defer" src="https://assets.adobedtm.com/a86419113799/01b0e221c0d2/launch-b2e52930cd27-development.min.js"></script>
<script src="/4.20/js/fix-location.js"></script><title data-rh="true">Generator使用者指南 | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.20/zh-TW/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.20/zh-TW/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator"><meta data-rh="true" name="docusaurus_locale" content="zh-TW"><meta data-rh="true" name="docsearch:language" content="zh-TW"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Generator使用者指南 | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.20/zh-TW/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.20/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.20/ko/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.20/ja/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.20/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.20/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.20/zh-TW/assets/css/styles.7d9223de.css">
<link rel="preload" href="/4.20/zh-TW/assets/js/runtime~main.eb896db1.js" as="script">
<link rel="preload" href="/4.20/zh-TW/assets/js/main.817e2aa6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">跳轉到主要內容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.20/zh-TW/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.20/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.20/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">繁體中文</a><ul class="dropdown__menu"><li><a href="/4.20/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/4.20/ko/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.20/ja/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.20/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li><li><a href="/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.20/zh-TW/docs/introduction/welcome">4.20</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator">4.20</a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">社區</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><div class="searchBox_Gz_y"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.20/zh-TW/docs/category/introduction">介紹</a><button aria-label="Toggle the collapsible sidebar category &#x27;介紹&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.20/zh-TW/docs/category/basic-concepts">基本概念</a><button aria-label="Toggle the collapsible sidebar category &#x27;基本概念&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/4.20/zh-TW/docs/development/development-introduction">開發</a><button aria-label="Toggle the collapsible sidebar category &#x27;開發&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.20/zh-TW/docs/development/hardware-selection/hardware-selection-introduction">硬體選擇</a><button aria-label="Toggle the collapsible sidebar category &#x27;硬體選擇&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.20/zh-TW/docs/development/board-bring-up/board-introduction">開發板搭建</a><button aria-label="Toggle the collapsible sidebar category &#x27;開發板搭建&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">TouchGFX AL開發</a><button aria-label="Toggle the collapsible sidebar category &#x27;TouchGFX AL開發&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-architecture">抽象層架構</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator">Generator使用者指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.20/zh-TW/docs/category/scenarios">場景</a><button aria-label="Toggle the collapsible sidebar category &#x27;場景&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.20/zh-TW/docs/development/ui-development/ui-development-introduction">UI開發</a><button aria-label="Toggle the collapsible sidebar category &#x27;UI開發&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.20/zh-TW/docs/category/scenarios-2">場景</a><button aria-label="Toggle the collapsible sidebar category &#x27;場景&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.20/zh-TW/docs/category/miscellaneous-1">其他情況</a><button aria-label="Toggle the collapsible sidebar category &#x27;其他情況&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.20/zh-TW/docs/category/tutorials">指導</a><button aria-label="Toggle the collapsible sidebar category &#x27;指導&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.20/zh-TW/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.20/zh-TW/docs/category/resources">資源</a><button aria-label="Toggle the collapsible sidebar category &#x27;資源&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="頁面路徑"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.20/zh-TW/docs/development/development-introduction"><span itemprop="name">開發</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction"><span itemprop="name">TouchGFX AL開發</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Generator使用者指南</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">在當前頁面</button></div><div class="theme-doc-markdown markdown"><header><h1>Generator使用者指南</h1></header><p>TouchGFX Generator是X-CUBE-TOUCHGFX的一部分，也是STM32CubeMX附加軟體元件，可幫助開發人員配置TouchGFX讓應用可在開發者的硬體平台上執行。 根據現有的STM32CubeMX設定與使用者的輸入，TouchGFX Generator將產生用以配置一個可運作的TouchGFX應用所需的所有檔案， 包含了TouchGFX HAL、TouchGFX OSAL和TouchGFX配置檔。</p><p>以STM32CubeMX產生程式碼後，可透過用來開發UI的TouchGFX Designer來打開TouchGFX專案。 TouchGFX Designer會自動將所有額外產生的程式碼檔案加入STM32CubeMX所指定的目標IDE當中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-touchgfx-generator">啟用TouchGFX Generator<a class="hash-link" href="#enabling-touchgfx-generator" title="直接連結到標題">​</a></h2><p>使用者可透過按「選擇元件（Select Components）」按鈕來存取X-CUBE以新增功能。</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/enable-generator.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/enable-generator.png"></a><p>在STM32CubeMX中選擇附加軟體（Additional Software）</p></div><p>下圖展示在專案中如何啟用TouchGFX Generator：</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/add-generator-v4.17.png" target="_blank"><img width="580" src="/4.20/zh-TW/img/development/touchgfx-hal-development/add-generator-v4.17.png"></a><p>啟用TouchGFX Generator</p></div><p>如果為雙核MCU啟用TouchGFX，請確保啟用正確的內容。 TouchGFX只能為單一內文啟用：</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/add-generator-dual-core-v4.17.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/add-generator-dual-core-v4.17.png"></a><p>啟用適用於雙核心的TouchGFX Generator</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-code-architecture">產生程式碼的架構<a class="hash-link" href="#generated-code-architecture" title="直接連結到標題">​</a></h2><p>在描述TouchGFX Generator的功能之前，先了解所產生程式碼的架構以及開發人員如何使用該架構來客製化配置和行為至關重要。</p><p>要保護由STM32CubeMX所產生的C程式碼中所加入的使用者程式碼，就必需將使用者程式碼置於<strong>「使用者程式碼（User Code）」程式碼區段</strong>當中。 在TouchGFX Generator所產生的C++程式碼中，這樣的靈活性是透過物件繼承的方式來實現。</p><p>透過<em>附加軟體（Additional Software）</em>新增並啟用TouchGFX Generator之後，STM32CubeMX會一直為專案建立一個<em>TouchGFX</em>資料夾。 無論配置如何，該資料夾總是包含相同的檔案成員，而檔案內容則因STM32CubeMX和使用者配置而異。</p><p>由以下的清單可看到<em>啟用</em>TouchGFX Generator之後的STM32CubeMX專案內容，並列出與TouchGFX相關較完整的檔案成員。 在清單之後的表格則列出了最重要專案的職責（responsibility）。</p><div class="code-header"><div><h5>TouchGFX 資料夾</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   .mxproject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   myproject.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Drivers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───EWARM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Middlewares</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└───TouchGFX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ApplicationTemplate.touchgfx.part</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├───App</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └───target</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXGPIO.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        └───generated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                OSWrappers.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXConfiguration.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.hpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>資料夾</th><th>職責（Responsibility）</th></tr></thead><tbody><tr><td>myproject.ioc</td><td>STM32CubeMX專案檔</td></tr><tr><td>核心</td><td><code>main.c</code>與啟動程式碼（startup code）</td></tr><tr><td>驅動程式</td><td>CMSIS與MCU系列驅動程式</td></tr><tr><td>EWARM</td><td>IDE專案資料夾。 可以為EWARM，MDK-ARM或STM32CubeIDE</td></tr><tr><td>中介軟體</td><td>包含TouchGFX函式庫/標頭檔以及FreeRTOS等第三方軟體。</td></tr><tr><td>ApplicationTemplate.touchgfx.part</td><td>STM32CubeMX使用與TouchGFX Designer專案相關的資訊（如螢幕尺寸和位元深度）來更新.part檔案</td></tr><tr><td>應用程式</td><td>為X-CUBE和STM32CubeMX的介面。 <code>app_touchgfx.c</code>包含了用於初始化TouchGFX並啟動其主迴圈的<code>MX_TouchGFX_Process (void)</code>和<code>MX_TouchGFX_Init (void) </code>二個函式的定義。</td></tr><tr><td>目標/生成</td><td>該子資料夾包含唯讀檔，當配置更改時，這些唯讀檔會被STM32CubeMX所覆蓋。 <code>TouchGFXGeneratedHAL.cpp</code>是TouchGFX的<code>HAL</code>物件類別的子類別，包含了STM32CubeMX根據目前的設定所產生的程式碼。 <code>OSWrappers.cpp</code>（OSAL）包含與TouchGFX引擎同步所需的函式。最後是<code>TouchGFXConfiguration.cpp</code>，包含了用來建構和設定TouchGFX（包括HAL）的程式碼。</td></tr><tr><td>目標</td><td>包含大量的檔案，使用者可修改這些檔案以擴展HAL行為，或者修改檔案以覆蓋由STM32CubeMX產生的配置。 <code>STM32TouchController.cpp</code>包含了觸控控制器操作的空介面。 <code>TouchGFXHAL.cpp</code>定義了<code>TouchGFXGeneratedHAL</code>的物件子類別<code>TouchGFXHAL</code>。</td></tr></tbody></table><p>需要注意的是<code>TouchGFXConfiguration.cpp</code>包含了一個用來建構HAL的函式， 以及一個用於啟動TouchGFX主迴圈的函式。 在可編輯的使用者類別<code>TouchGFXHAL</code>當中可以新增附加的配置。 HAL的一般架構如下所示 ：</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/code-architecture.png" target="_blank"><img width="200" src="/4.20/zh-TW/img/development/touchgfx-hal-development/code-architecture.png"></a><p>產生的程式碼之階層結構</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-overview">特性概述<a class="hash-link" href="#feature-overview" title="直接連結到標題">​</a></h2><p>Having enabled TouchGFX Generator, three main groups exist in the user interface. A fourth, &quot;Dependencies&quot;, will appear if a problem with the current configuration is detected.</p><ul><li><strong><em>相依關係（Dependencies）</em></strong> - 此設定專案群組用來通知開發人員包含配置中的相依關係、警告或具體錯誤的訊息。 若沒有條目則該專案群組將隱藏。</li><li><strong><em>顯示（Display）</em></strong> - 此設定專案群組包含與顯示有關的配置如介面、影像緩衝區的位元深度、寬度和高度。 這些配置會直接影響TouchGFX專案裡畫布（canvas）的大小以及根據圖源資產（asset）所產生的程式碼。</li><li><strong><em>Driver</em></strong> - This group allows the user to opt-in for a number of ready-made drivers related to the tick source of the application, graphics acceleration (DMA2D and GPU2D) and RTOS. 由於STM32CubeMX支援FreeRTOS（CMSIS RTOS v1與v2）的配置設定，TouchGFX Generator可為每個選項提供驅動程式。</li><li><strong><em>Additional Features</em></strong> - This group appears if RGB565 is selected, allowing the user to create am application using image- and font-data from non-memory mapped flash.</li><li><strong><em>影片解碼</em></strong> - 該組允許使用者啟用硬體或軟體影片解碼。 該選項對於影片控制是必要的。 注意！不是所有的MCU都支援影片解碼。</li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/four-sections.png" target="_blank"><img width="600" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/four-sections.png"></a><p>TouchGFX Generator has three groups: Display, Driver and Video Decoding</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="display">顯示（Display）<a class="hash-link" href="#display" title="直接連結到標題">​</a></h2><p><em>顯示（Display）</em>設定專案群組群組包含與顯示有關的配置，如介面、尺寸和緩衝區使用策略。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interface-and-dimensions">介面與尺寸<a class="hash-link" href="#interface-and-dimensions" title="直接連結到標題">​</a></h3><p>目前STM32微控制器可使用多種顯示介面，如：</p><ul><li>平行RGB（LTDC）</li><li>MIPI DSI</li><li>FMC</li><li>SPI</li></ul><p>如果MCU帶有連接到LTDC或FMC的顯示器，<em>TouchGFX Generator</em>可生成程式碼，以將影像緩衝器傳輸到連接的顯示器。 而對於DSI和SPI介面來說，驅動程式必須由開發人員自行實作。</p><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">有關不同顯示介面的程式碼程式的具體範例請參閱<a href="/4.20/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb">使用情境（Scenarios）</a>章節。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="framebuffer-pixel-format">影像緩衝區像素格式<a class="hash-link" href="#framebuffer-pixel-format" title="直接連結到標題">​</a></h3><p>TouchGFX Generator目前支援以下影像緩衝像素格式。 當使用“自訂”顯示介面時，所有選項均可用，否則選項被限制為顯示控制器設置（例如，在TouchGFX Generator中配置LTDC Framebuffer格式為“RGB565”將選項限制為“RGB565”）。</p><ol><li>BW (1bpp)</li><li>Grey2 (2bpp)</li><li>Grey4 (4bpp)</li><li>ABRG2222 (8bpp)</li><li>ARGB2222 (8bpp)</li><li>BGRA2222 (8bpp)</li><li>RGBA2222 (8bpp)</li><li>RGB565 (16bpp)</li><li>RGB888 (24bpp)</li><li>ARGB8888 (32bpp)</li><li>XRGB8888 (32bpp)</li></ol><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">一些像素格式沒有或僅有部分ChromART（DMA2D）支援。</div></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content"><b>For STM32F7/H7</b>: If the framebuffer is placed in Write Through cached memory (e.g. SRAM) then the DCache is flushed by the generated code prior to DMA2D (if configured in the Generator) accessing it. 記住要在STM32CubeMX中的<b>Cortex M7</b>的<b>系統核心</b>設置中啟用<b>CPU快取</b>，這樣快閃機制才能正常工作。</div></div><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">如需關於CPU快取的詳細資訊，請參閱<a href="/4.20/zh-TW/docs/development/board-bring-up/how-to/02-cpu-running#cache-on-f7-and-h7">F7和H7小節中的“Cache（快取）”</a>。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffering-strategies">緩衝區策略<a class="hash-link" href="#buffering-strategies" title="直接連結到標題">​</a></h3><p>可透過TouchGFX Generator設定以下影像緩衝區策略：</p><ul><li><strong>單一影像緩衝區</strong> - 僅使用一個應用影像緩衝區。 性能可能會受限，但記憶體用量較少。 可與「緩衝區位置（Buffer Location）」的配置一起使用以將其放置在內部RAM當中。 若需更進一步的最佳化，使用者可以定義一個函式來回傳顯示控制器當前正在處理的「行（current line）」。 框架可使用該方法在該圖框當中對內容已被傳輸到顯示器的記憶體作更新。</li><li><strong>雙影像緩衝區</strong> - 使用兩個影像緩衝區。 通常是指以更大的記憶體用量為代價來換取更好的性能。</li><li><strong>局部緩衝區</strong> - 將一個或多個由使用者定義的記憶體區塊作為影像緩衝區。 此策略適用於不依賴外部RAM但所使用連接的顯示器其全部完整的影像緩衝區卻超過內部可用記憶體這類型低成本的方案。</li></ul><p>對單一緩衝區與雙緩衝區來說，使用者可透過「緩衝器位置（Buffer Location）」來設定其記憶體位置，此設定提供以下選項：</p><ul><li><strong>依配置（By Allocation）</strong> - 允許連結器根據連結器設定檔來放置影像緩衝記憶體。 預設選項為置於內部RAM（internal RAM）中。</li><li><strong>依位址（By Address）</strong> - 允許使用者定義一個（單）或兩個（雙）影像緩衝區位址。</li></ul><p><strong>局部緩衝區</strong>策略允許使用者定義以下參數：</p><ul><li>區塊數量（始終放置在內部RAM中）</li><li>區塊大小（位元組數）</li></ul><p>要了解有關局部緩衝策略的一些核心概念，請閱讀關於「使用局部影像緩衝區以降低記憶體用量」的<a href="/4.20/zh-TW/docs/development/scenarios/lowering-memory-usage-with-partial-framebuffer">專文</a> 此專文從概念上說明了如何實現局部緩衝區，而要稍微留意的是在專文中所展示的程式碼會與TouchGFX Generator所產生的程式碼略有不同。 有關為這些策略而產生的具體程式碼範例，請參見<a href="/4.20/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-framebuffer-strategies">影像緩衝策略</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="driver">驅動程式<a class="hash-link" href="#driver" title="直接連結到標題">​</a></h2><p>這個驅動程式的設定專案群組讓開發人員可以為TouchGFX AL的各種功能選擇驅動程式。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-tick-source">應用時標源（Application Tick Source）<a class="hash-link" href="#application-tick-source" title="直接連結到標題">​</a></h3><p>應用時標源定義了應用程式的運作進行方式。 開發人員有以下的選項：</p><ul><li><strong>LTDC</strong> - 如果在「顯示（Display）」的設定專案群組當中將介面（Interface）設為「LTDC」，則應用時標源即可設定為「LTDC」。 這表示TouchGFX Generator將在<code>TouchGFXGeneratedHAL</code>物件類別當中置入驅動函式（LTDC中斷處理程式）並在此驅動函式當中透過呼叫<code>OSWrappers::signalVSync()</code>來驅使應用程式的運作。</li><li><strong>客製化和FMC</strong> &gt; - 在這種情況下，開發人員需要自行實作一個處理函式（handler）以便透過重複呼叫<code>OSWrappers::signalVSync()</code>來驅使應用程式的運作。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphics-accelerator">圖形加速器<a class="hash-link" href="#graphics-accelerator" title="直接連結到標題">​</a></h3><p>關於圖形加速開發人員有三個選項：</p><ul><li><strong>None</strong> - The application renders using only the CPU.</li><li><strong>DMA2D Accelerator (ChromART)</strong> - The application uses the ChromART chip when possible to move and blend pixels, freeing up CPU cycles. The driver is generated by TouchGFX Generator and does not require any action from the developer.</li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-dma2d.png" target="_blank"><img width="200" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-dma2d.png"></a><p>DMA2D is enabled in the *Multimedia* category in CubeMX, for MCUS that support it.</p></div><p>TouchGFX Generator提供的Chrom-ART （DMA2D） 驅動程式支援兩種TransferCompleteInterrupt的處理方式：</p><ol><li>使用STM32Cube HAL驅動程式，其中回呼函式（callback function）註冊到dma2d的控制程式碼（handle）<code>hdma2d. XferCpltCallback</code>。</li><li>直接使用中斷處理程式<code>DMA2D_IRQHandler ()</code>。</li></ol><p>在STM32CubeMX藉由開啟或關閉DMA2D IP配置NVIC Setting分頁裡的DMA2D全域中斷，便可以在這兩種方式之間作切換。 開啟全域中斷可以產生選項1的程式碼，關閉全域中斷可以產生選項2的程式碼。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>When using global interrupt for DMA2D, ensure that the &quot;IRQ handler&quot; calls the &quot;DMA2D HAL handler&quot;. This is default behaviour.</li><li>如果在啟用全域中斷的同時閉閉DMA2D的「IRQ處理函式」和「HAL處理函式的呼叫」將導致註冊的回呼函式永遠不會被呼叫。</li></div></div><ul><li><strong>GPU2D (NeoChrom)</strong> is a graphics accelerator capable of accelerating many of the drawing operations in TouchGFX, including texture mapping. It supports framebuffers in RGB565, RGB888, and ARGB8888 formats.</li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-gpu2d.png" target="_blank"><img width="190" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/multimedia-group-gpu2d.png"></a><p>GPU2D is enabled in the *Multimedia* category in CubeMX, for MCUS that support it.</p></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content">The GPU2D option is only visible if GPU2D has been enabled in the <i>Multimedia</i> section for your project in CubeMX. It is only available for STM32U599 devices and can only be enabled for use with TouchGFX if the ThreadX RTOS from the <i>Middlewares</i> section is also enabled.</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-time-operating-system">即時作業系統<a class="hash-link" href="#real-time-operating-system" title="直接連結到標題">​</a></h3><p>開發人員可在TouchGFX使用任何的RTOS（甚至不使用作業系統）。 如「抽象層架構（Abstration Layer Architecture）」中所述，依據使用者所選的RTOS，TouchGFX引擎使用<code>OSWrappers</code>介面來同步TouchGFX引擎的主要事件迴圈和影像緩衝區之間的存取。 When developers choose an operating system in TouchGFX Generator, code will be generated to syncronize internally via primitives for the OS of choice. 作業系統仍然必須通過STM32CubeMX進行配置，以確定堆疊大小等。</p><p>FreeRTOS (CMSIS OS V1 and V2) and ThreadX (Native Middleware or Azure RTOS Software Packs) can be configured directly from within STM32CubeMX and TouchGFX Generator providing the user with generated code for both task definitions and TouchGFX RTOS driver. TouchGFX Generator can generate CMSIS V1 and CMSIS V2 compliant RTOS drivers which work with any CMSIS compliant RTOS, a driver for ThreadX, and a driver for running bare metal without an operating system.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="threadx-middleware-os">ThreadX<a class="hash-link" href="#threadx-middleware-os" title="直接連結到標題">​</a></h4><p>ThreadX can be enabled either by selecting an AZRTOS Software Pack or by enabling the Native ThreadX Middleware from STM32CubeMX, if available for the selected MCU device.</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>All new STM32 MCU devices will support, by default, ThreadX Middleware directly available from STM32CubeMX without requiring additional pack downloads. TouchGFX Board Support packs will slowly transition to using either ThreadX middleware, where available, or X-CUBE-AZRTOS software packs.</li><li>X-CUBE-AZRTOS-XX Expansion Packs providing ThreadX support are already available for the <i>STM32G0xx, STM32G4xx, STM32L4xx, STM32F4xx, STM32F7xx</i> and the <i>STM32H7xx</i> MCU Series.</li></div></div><p>下圖顯示了透過TouchGFX Generator可用的選項。</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options-threadx.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options-threadx.png"></a><p>RTOS驅動程式選項</p></div><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li><b><i>NoOS</i></b> option is disabled when <b>ThreadX</b> Middleware is enabled.</li><li><b><i>CMSIS_RTOS_V1</i></b> and <b><i>CMSIS_RTOS_V2</i></b> options are disabled when <b>ThreadX</b> Middleware is enabled. CMSIS OS wrapper is not provided by ST, customer has to select <b><i>Custom</i></b> option and implement the CMSIS wrapper.</li></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-and-configuring-threadx-from-the-middleware-list-available-in-stm32cubemx">Enabling and configuring ThreadX from the Middleware list available in STM32CubeMX<a class="hash-link" href="#enabling-and-configuring-threadx-from-the-middleware-list-available-in-stm32cubemx" title="直接連結到標題">​</a></h5><p>A succesful memory configuration for ThreadX relies on <i>Memory Pool Allocation</i>. The recommended value is <i>Static Allocation</i>. Perform the folowing steps in the ThreadX Middleware configuration:</p><ul><li>Enable <code>THREADX</code> Middleware by selecting <code>Core</code> from the Mode list, as seen in the figure below.</li><li>Set <code>TX_TIMER_TICKS_PER_SECOND</code> to <strong>1000</strong> to get Ticks each one millisecond</li><li>Set <code>Memory Pool Allocation</code> to <strong>Use Static Allocation</strong></li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/enable-and-configure-native-threadx-mw.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/enable-and-configure-native-threadx-mw.png"></a><p>Enabling and Configuring Native ThreadX Middleware</p></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content"><li><b>Memory Pool Allocation</b> should be set to <b>Use Dynamic Allocation</b> when <b>Native ThreadX Middleware</b> is enabled</li><ul><li>When <b>Memory Pool Allocation</b> is set to <b>Use Dynamic Allocation</b></li><ul><li>User will have to add the missing code in the <i>USER CODE BEGIN DYNAMIC_MEM_ALLOC</i> section in the generated <b><i>app_azure_rtos.c</i></b> file.</li><li>User will need also to update the linker files following the recemmendation described in the generated <b><i>app_azure_rtos.c</i></b> file.</li></ul></ul></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-and-configuring-threadx-from-azrtos-software-pack">Enabling and configuring ThreadX from AZRTOS Software Pack<a class="hash-link" href="#enabling-and-configuring-threadx-from-azrtos-software-pack" title="直接連結到標題">​</a></h5><ul><li>Select <strong>Software Packs -&gt; Select Components</strong> or Press <code>Alt-O</code>.</li><li>Select <strong>STMicroelectonics.X-CUBE-AZRTOS-XX</strong>. Download the pack if required.</li><li>Select <strong>RTOS ThreadX</strong> and check the <strong>Core</strong> check box to enable ThreadX. You can now safely close the <i>Software Packs Component Selector</i>.</li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos.png"></a><p>Enabling ThreadX from an X-CUBE-AZRTOS Software Pack</p></div><ul><li>Select the <i>Software Packs</i> group from the <i>Categories</i> list on the left hand side and select <strong>STMicroelectonics.X-CUBE-AZRTOS-XX</strong></li><li>Enable ThreadX by selecting the mode <strong>RTOS ThreadX</strong></li><li>Set <code>Memory Pool Allocation</code> to <strong>Use Static Allocation</strong></li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config1.png" target="_blank"><img width="800" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config1.png"></a><p>ThreadX Configuration - X-CUBE-AZRTOS Software Pack</p></div><ul><li>Set <code>TX_TIMER_TICKS_PER_SECOND</code> to <strong>1000</strong> to get ticks once per millisecond.</li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config2.png" target="_blank"><img width="800" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/x-cube-azurertos-config2.png"></a><p>ThreadX Configuration - X-CUBE-AZRTOS Software Pack</p></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="freertos-middleware-os">FreeRTOS<a class="hash-link" href="#freertos-middleware-os" title="直接連結到標題">​</a></h4><p>呼叫以下函式即進入TouchGFX主迴圈。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>開發者需要在執行TouchGFX任務的處理函式（task handler）當中呼叫此函式。 如果使用者從STM32CubeMX配置了名為 <code>DefaultTask </code>的FeeRTOS任務，則以下範例顯示了如何呼叫 <code>MX_TouchGFX_Process() </code>，以啟動其任務處理函式的使用者程式碼部分中的TouchGFX。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">StartDefaultTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argument</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN 5 */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END 5 */</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>STM32CubeMX will also generate a call to <code>osKernelStart();</code> which starts the scheduler.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="threadx-middleware-os">ThreadX Middleware<a class="hash-link" href="#threadx-middleware-os" title="直接連結到標題">​</a></h4><p>STM32CubeMX is no more responsible of generating the code creating the threads for middlewares and for the user.<br> STM32CubeMX will generate the call to the <code>MX_TouchGFX_PreOSInit()</code> function which will initialize the TouchGFX framework<br> STM32CubeMX will generate the call to the <code>MX_ThreadX_Init()()</code> function which will initialize and start the ThreadX kernel</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Call PreOsInit function */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_PreOSInit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN 2 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END 2 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_ThreadX_Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TouchGFX Generator will generate the <code>MX_TouchGFX_PreOSInit()</code> function which will simply call the <code>touchgfx_init()</code></p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * PreOS Initialization function</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_PreOSInit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Calling forward to touchgfx_init in C++ domain</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">touchgfx_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TouchGFX Generator will generate the <code>MX_TouchGFX_Init()</code> function which will create the TouchGFX thread</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * Create TouchGFX Thread</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UINT </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">memory_ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  UINT ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CHAR </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">pointer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Allocate the stack for TouchGFX Thread.  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">tx_byte_allocate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TX_BYTE_POOL</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">memory_ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">pointer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                       TOUCHGFX_STACK_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_NO_WAIT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TX_POOL_ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Create TouchGFX Thread */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">tx_thread_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">TouchGFXThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CHAR </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TouchGFX&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TouchGFX_Task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                       pointer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TOUCHGFX_STACK_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                       </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">                       TX_NO_TIME_SLICE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_AUTO_START</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TX_THREAD_ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TouchGFX Generator will generate the required code which will be inserted by STM32CubeMX into the file <b><i>app_azure_rtos.c</i></b></p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @brief  Define the initial system.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param  first_unused_memory : Pointer to the first unused memory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @retval None</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">VOID </span><span class="token function" style="color:rgb(130, 170, 255)">tx_application_define</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">first_unused_memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">tx_byte_pool_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">touchgfx_app_byte_pool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TouchGFX App memory pool&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> touchgfx_byte_pool_buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TOUCHGFX_APP_MEM_POOL_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN TouchGFX_Byte_Pool_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END TouchGFX_Byte_Pool_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN TouchGFX_Byte_Pool_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END TouchGFX_Byte_Pool_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory_ptr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VOID </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">touchgfx_app_byte_pool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">memory_ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> TX_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN  MX_X-CUBE-TOUCHGFX_Init_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END  MX_X-CUBE-TOUCHGFX_Init_Error */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN  MX_X-CUBE-TOUCHGFX_Init_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END  MX_X-CUBE-TOUCHGFX_Init_Success */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>tx_application_define()</code> function is called by the ThreadX kernel at initialization time.<br> The <code>MX_TouchGFX_Init()</code> function is called by <code>tx_application_define()</code>.<br> The TouchGFX thread will be started later when the ThreadX kernel is started.</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>STM32CubeMX generate full code only the <b>Static Memory Pool Allocation</b> configuration for the <b>ThreadX Middlewares</b>.</li><li>Please refer to the <i>STM32H7B3I-DK/Applications/AnimatedImages</i> example available inside the <b>X-CUBE-TOUCHGFX</b> expansion pack if you want to configure ThreadX with <b>Dynamic Memory Allocation</b></li></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-cmsis-compliant-os">其他CMSIS相容的OS<a class="hash-link" href="#other-cmsis-compliant-os" title="直接連結到標題">​</a></h4><p>當開發人員不使用STM32CubeMX 所提供的FreeRTOS和ThreadX而要採用其他CMSIS相容的即時作業系統時就必須自行手動完成RTOS配置和任務定義。 通常需要以下步驟：</p><ol><li>設定RTOS</li><li>定義用來執行TouchGFX的任務（以便在其中呼叫<code>MX_TouchGFX_Process</code>）</li><li>啟動排程器（scheduler）</li></ol><p>於任務處理函式當中呼叫<code>MX_TouchGFX_Process</code>以啟動TouchGFX引擎主迴圈。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-features">額外功能<a class="hash-link" href="#additional-features" title="直接連結到標題">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-data-reader">外部資料讀取器<a class="hash-link" href="#external-data-reader" title="直接連結到標題">​</a></h4><p>對於RGB565影像緩衝像素格式，TouchGFX支援所謂的<em>資料讀取器（Data Reader）</em>介面，讓開發者能夠直接從非記憶體映射（non-memory-mapped）的序列式快閃記憶體（serial flash）讀取資料，而無需進行<a href="/4.20/zh-TW/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps">暫存（caching）</a>，當然這需要增加額外的緩衝儲存區。 有關如何實作DataReader以便由非記憶體映射（non-memory-mapped）的快閃記憶體當中獲取應用程式圖資（asset）的範例請參見<a href="/4.20/zh-TW/docs/development/scenarios/using-serial-flash">Serial Flash</a>文章。</p><p><em>資料讀取器（Data Reader）</em>選項通常適用在如STM32G0這一類沒有足夠的記憶體用於額外緩衝區的低成本解決方案。 在啟用DMA2D之後便無法啟用這個選項。</p><p>將影像緩衝像素格式（Framebuffer Pixel Format）設為<em>RGB565</em>之後便可看到新增了<em>附加功能（Additional Features）</em>設定項群組。</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.png" target="_blank"><img width="520" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.png"></a><p>額外功能: 資料讀取器（Data Reader）</p></div><p>開發人員可進行以下設定：</p><ul><li><strong>外部資料讀取器</strong>：以來啟用或關閉功能。 如果啟用，TouchGFX會直接透過所產生的介面獲取圖資（assets）。 如果功能關閉，則開發者需要將影像<em>暫存（cache）</em>到記憶體緩衝區中。</li><li><strong>外部資料讀取器</strong>：建立兩個緩衝區以便將影像或文字混合到影像緩衝區當中。 預設值為一個螢幕寬度乘上4位元組以支援ARGB8888像素格式的全尺寸影像。</li><li><strong>最小DMA傳輸量</strong>：設定啟動DMA傳輸所需的最小位元組。 如果請求的傳輸量少於最小位元組便不會用到DMA。</li></ul><p>在啟用<em>外部資料讀取器（External Data Reader）</em>的情況下產生程式碼會建立如下的附加檔案以利直接從非記憶體映射（non-memory-mapped）的快閃記憶體中獲取圖資（asset）。</p><ul><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.hpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.cpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.hpp</code></li></ul><p>像往常一樣，TouchGFX Generator產生的程式碼<code>TouchGFXGeneratedDataReader</code>為唯讀，使用者的修改應該要在<code>TouchGFXDataReader</code>物件類別中進行。 而<code>TouchGFXGeneratedDataReader</code>繼承自<code>touchgfx::FlashDataReader </code>物件類別 。</p><p>TouchGFX Generator會修改以下檔案來配置TouchGFX HAL以使用<code>DataReader</code>。</p><ul><li><code>TouchGFX/target/generated/TouchGFXConfiguration.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.hpp</code></li></ul><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">只有在同時關閉DMA2D與LTDC的情況之下才可使用DataReader附加功能。</div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8bit-ltdc-color-look-up-table">8位元 LTDC顏色查找表（Look-up Table）<a class="hash-link" href="#8bit-ltdc-color-look-up-table" title="直接連結到標題">​</a></h4><p>當LTDC設定為以L8的格式讀取影像緩衝區，並且TouchGFX以<!-- -->[ABRG2222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp<strong><em>a_b_g_r2222), <!-- -->[ARGB222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp</em></strong>a_r_g_b2222), <!-- -->[BGRA2222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp<strong><em>b_g_r_a2222)， 或<!-- -->[RGBA2222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp</em></strong>r_g_b_a2222)的方式作渲染算圖時，TouchGFX Generator將提供CLUT，並在<code>TouchGFXHAL::initialize()</code>期間將該CLUT載入到LTDC中。 有關LTDC和CLUT的用法，詳見STM32 MCU參考手冊。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding">影片解碼<a class="hash-link" href="#video-decoding" title="直接連結到標題">​</a></h2><p>‘影片解碼’部分允許開發人員通過硬體或軟體影片解碼能力增強TouchGFX HAL。</p><p>影片解碼僅支援RGB565（16bpp）和RGB888（24bpp）影像緩衝像素格式。 如果沒有選擇這兩種格式，則影片解碼部分將不可用。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">不是所有MCU都支援硬體影片解碼。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-type">類型<a class="hash-link" href="#video-decoding-type" title="直接連結到標題">​</a></h3><p>預設情況下，影片解碼的”類型”是禁用的。 如果STM32CubeMX中沒有啟用所需的外設，“軟體”和“硬體”都將顯示為灰色。 將滑鼠懸停在灰色的選項上，看看需要哪些外設。</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-dependecies-info-box.png" target="_blank"><img width="800" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-dependecies-info-box.png"></a><p>資訊框顯示“硬體”的影片類型依賴項</p></div><ul><li><strong>軟體</strong> - 如果在STM32CubeMX的中介軟體部分啟用了LIBJPEG，則可以選擇“軟體”選項，並生成軟體解碼器。 這意味著TouchGFX Generator將生成一個軟體MJPEG解碼器。</li><li><strong>硬體</strong> - 如果在多媒體部分啟用了JPEG，並且在TouchGFX Generator中選擇了符合CMSIS要求的RTOS，則可以選擇“硬體”選項。</li></ul><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-options-4-18.png" target="_blank"><img width="800" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-options-4-18.png"></a><p>影片解碼類型選項</p></div><p>在LIBJPEG設置中，為了提高效率，“RGB掃描線格式”中的RGB排序必須設置為“BGR”而不是“RGB”。 每個像素的位元組數必須設置為3。</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/libjpeg-rgb-ordering.png" target="_blank"><img width="700" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/libjpeg-rgb-ordering.png"></a><p>需要的LIBJPEG RGB掃描線格式設置</p></div><p>使用硬體解碼時，JPEG設置中的RGB格式必須與顯示器相同。</p><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">有關不同影片解碼的具體範例請參閱<a href="/4.20/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-video-decoding">使用情境（Scenarios）</a>章節。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-number">併發影片<a class="hash-link" href="#video-decoding-number" title="直接連結到標題">​</a></h3><p>“併發影片”選項可設置GUI中任意給定時間在同一螢幕上同時被解碼的最大數量影片。 如果希望一塊螢幕上只解碼一個影片，則可以將“影片數量”設置為1。</p><p>最多可以同時解碼4個影片。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-strategy">策略<a class="hash-link" href="#video-decoding-strategy" title="直接連結到標題">​</a></h3><p>關於影片解碼策略，開發人員有三種選擇。</p><ul><li>“<strong>直接到影像緩衝區（Direct to Framebuffer）</strong>” - 影片在UI執行緒中被解碼。 解碼速度慢於其他策略。 使用硬體影片解碼時，“直接到影像緩衝區（Direct to Framebuffer）選項不可被使用。</li><li><strong>單緩衝區</strong> - 在專用的緩衝區中，以單獨的任務進行影片解碼。 該緩衝區位於內部記憶體中。</li><li><strong>雙緩衝區</strong> - 在兩個專用緩衝區中，以單獨的任務進行影片解碼，以犧牲記憶體為代價獲得更好的性能。</li></ul><p>採用單或雙影像緩衝區策略時，必須啟用符合CMSIS要求的作業系統。</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-rtos-requirement-info-box.png" target="_blank"><img width="750" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-rtos-requirement-info-box.png"></a><p>關於CMSIS RTOS要求的資訊框</p></div><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">使用雙緩衝區策略時，要注意記憶體消耗。</div></div><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">關於配置用於影片解碼的FreeRTOS的具體範例，請參見“<a href="/4.20/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-video-decoding">場景</a>”部分。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="decode-format">解碼格式<a class="hash-link" href="#decode-format" title="直接連結到標題">​</a></h3><p>對於軟體解碼，開發人員可以選擇RGB緩衝區的像素格式，不管影像緩衝區的像素格式是什麼。 TouchGFX Generator生成的程式碼允許ChromART在不同的格式之間進行像素格式轉換。 在RGB565中擁有影片解碼緩衝區允許開發人員佔用更小的記憶體。</p><div class="figure noshadow"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-decode-format.png" target="_blank"><img width="700" src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/video-decoding-decode-format.png"></a><p>解碼格式</p></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="video-decoding-buffer-size">緩衝區大小：<a class="hash-link" href="#video-decoding-buffer-size" title="直接連結到標題">​</a></h3><p>緩衝區的寬度和高度設置必須對應應用程式中的最大影片尺寸。 寬度值必須能被32整除。</p><p>以下程式碼是在<code>TouchGFXGeneratedHAL.cpp</code>中生成的程式碼，其面向的應用程式使用RGB888顯示器 - 採用480*272影片和“單緩衝區”影片解碼策略。</p><div class="code-header"><div><h5>TouchGFXGeneratedHAL.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;DedicatedBufferVideoController.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;SoftwareMJPEGDecoder.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> lineBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SoftwareMJPEGDecoder </span><span class="token function" style="color:rgb(130, 170, 255)">mjpegdecoder1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">lineBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> videoRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">97920</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DedicatedBufferController</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">272</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">3U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Bitmap</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">RGB888</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Singleton Factory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">VideoController</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">VideoController</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXGeneratedHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">HAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">registerEventListener</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Application</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">setFrameBufferStartAddresses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">frameBuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">frameBuf </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">frameBuf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     * Add software decoder to video controller</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">addDecoder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mjpegdecoder1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    videoController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">videoRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">videoRGBBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-project">產生的專案<a class="hash-link" href="#generated-project" title="直接連結到標題">​</a></h2><p>使用STM32CubeMX中的<strong>產生程式碼（Generate Code）</strong>按鈕產生程式碼時可產生以下IDE的TouchGFX專案檔：</p><ol><li>EWARM</li><li>MDK-ARM</li><li>STM32CubeIDE</li></ol><p>藉由選取以下與專案產生相關的選項可以得到較佳的專案目錄結構：</p><ul><li>應用結構：<strong>進階</strong></li><li>關閉 <strong>Generate under root</strong>（僅適用於STM32CubeIDE）</li></ul><div class="figure"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.png"></a><p>選取「進階的應用程式結構（Advanced application structure）」並取消選取「Generate under root」</p></div><p>STM32CubeMX還會產生具有以下目錄結構的<em>TouchGFX</em>資料夾：</p><div class="figure"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.png"></a><p>TouchGFX資料夾結構</p></div><ul><li><em>應用</em>資料夾包含用於初始化和啟動TouchGFX的程式碼。</li><li><em>target</em>資料夾包含產生的唯讀程式檔（置於generated/目錄中）和可修改的使用者物件類別檔（<code>STM32TouchController.cpp</code> ，<code>TouchGFXGPIO.cpp</code>和<code>TouchGFXHAL.cpp</code>）</li><li><em>.part</em>檔案，使用TouchGFX Designer來開啟以建立完整的TouchGFX專案（包括TouchFX的標頭檔和函式庫）。part檔案包含為了產生TouchGFX應用程式碼設計人員需使用的相關程式資訊（如像素格式與畫布尺寸）。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-designer-project">TouchGFX Designer專案<a class="hash-link" href="#touchgfx-designer-project" title="直接連結到標題">​</a></h2><p>The following json structure is an example of the contents of the <code>.part</code> file mentioned in the <a href="#generated-code-architecture">Generated Code Architecture</a> section for a project based on STM32U599. The post-generate command in the example below will update the project selected by the user in STM32CubeMX Project Manager tab (e.g. EWARM) with required libraries for TouchGFX and optional components as well as new files created by TouchGFX designer (e.g. new screens and assets).</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Application&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;STM32U599J-DK&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;TouchGfxPath&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../Middlewares/ST/touchgfx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;AvailableColorDepths&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;AvailableLCDs&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;24&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LCDGPU2D&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;AvailableResolutions&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;Width&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;Height&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;PostGenerateTargetCommand&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;touchgfx update_project&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Family&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;STM32U5&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;SubFamily&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;STM32U599/5A9&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Platform&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;m33&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;ProjectFile&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../STM32U599J-DK.ioc&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;OptionalComponentsRoot&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../Middlewares/ST/touchgfx_components&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;OptionalComponents&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GPU2D&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;4.19.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用TouchGFX Designer開啟<em>.part</em>檔案時，開發人員可以選擇載入具體實際的UI或從空白範本開始。</p><div class="figure"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui-4-17.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui-4-17.png"></a><p>選擇UI</p></div><p>按下TouchGFX Designer當中的<em>產生程式碼（Generate Code）</em>之後可得到如下的TouchGFX資料夾結構。 由下圖可看到TouchGFX資料夾結構的具體範例，當中以高亮度強調了產生後的新檔案及資料夾。</p><div class="figure"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code-4-17.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code-4-17.png"></a><p>產生程式碼</p></div><div class="figure"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.png"></a><p>TouchGFX資料夾結構</p></div><p>TouchGFX將從STM32CubeMX的.ioc檔當中偵測所選取的IDE（STM32CubeIDE，EWARM，MDK-ARM），並使用新生成的檔案（如用於螢幕定義、圖像和字型的圖資）來更新專案檔。</p><p>此時，開發人員可以交互使用STM32CubeMX，TouchGFX Designer和工具鏈/IDE，其中：</p><ul><li>STM32CubeMX可以更新IDE專案中的驅動程式</li><li>STM32CubeMX根據UI相關變更來更新TouchGFX <em>.part</em>檔案，而設計工具（designer）可同時立即取得這些變更</li><li>STM32CubeMX根據TouchGFX與平台相關的TouchGFX Generator配置來產生HAL程式碼（TouchGFX/target/generated/）。</li><li>TouchGFX Designer使用產生的程式碼來更新專案。</li></ul><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">對於雙核專案（為特定內文啟用TouchGFX），TouchGFX專案通常會位於該內文的專用資料夾中，例如:“CM4 / TouchGFX”或“CM7 / TouchGFX”。</div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-generated-behavior">修改所產生的行為<a class="hash-link" href="#modifying-generated-behavior" title="直接連結到標題">​</a></h2><p>需要注意的是，HAL的物件類別階層結構讓使用者可以覆寫（override）STM32CubeMX所產生的HAL配置或行為（behavior）。 在以下範例中，開發人員可以修改<code>initialize</code>函式對TouchGFX作額外的配置，或修改<code>TouchGFXGeneratedHAL</code>當中現有的配置集組。</p><div class="code-header"><div><h5>TouchGFXHAL.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Calling parent implementation of initialize().</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 若要覆寫生成的實現，請忽略對父函數的呼叫</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 並在此處實現所需的功能。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 請注意：必須呼叫HAL::initialize()以初始化框架。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXGeneratedHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//覆蓋配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lockDMAToFrontPorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setFingerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-projects">升級專案<a class="hash-link" href="#upgrading-projects" title="直接連結到標題">​</a></h2><p>TouchGFX Generator的相關參數儲存在STM32CubeMX專案檔.ioc當中。 當發佈新版TouchGFX Generator時，舊版的參數可能與新版的參數不相容，此時便需要進行轉移（migration）。</p><p>STM32CubeMX不支援X-CUBE版本之間的升級。而由於<code>.touchgfx</code>檔案內<code>PostGenerateTargetCommand</code>當中的指令（如下所示），因此在按下<em>Generate Code</em>時TouchGFX Designer會自動執行升級。</p><div class="code-header"><div><h5>.touchgfx</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;PostGenerateTargetCommand&quot; : &quot;touchgfx update_project --project-file=../upgrade.ioc --platform=m7&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這道指令將讀取<code>.ioc</code>檔並更新參數以適應X-CUBE-TOUCHGFX目前的版本。 由以下範例可以看到如何透過手動執行X-CUBE-TOUCHGFX 4.14.0的腳本（script）指令對X-CUBE-TOUCHGFX 4.13.0所建立的.ioc檔案進行升級。</p><div class="code-header"><div><h5>使用STM32F746 DISCO應用範本從4.13.0升級到4.14.0的範例</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ touchgfx update_project --project-file=../STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  TouchGFX Generator 4.13.0 found</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Creating backup of ../STM32F746G_DISCO.ioc as ../backup_STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Performing upgrade 4.13.0 -&gt; 4.14.0 ... OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以STM32CubeMX開啟升級過的專案時CubeMX會提示使用者要安裝.ioc檔所指定的X-CUBE-TOUCHGFX版本（若指定版本尚未安裝的情況下）。 點選<em>立即下載（Download now）</em>後將下載並安裝X-Cube-TouchGFX-4.14.0。</p><div class="figure"><a href="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.png" target="_blank"><img src="/4.20/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.png"></a><p>遺漏附加軟體：TouchGFX Generator 4.14.0</p></div><p>升級期間會保留TouchGFX Generator中的所有設定，.ioc檔的備份檔會以前置檔名<code>backup_</code>的方式放成原始檔旁。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">要使用TouchGFX Generator所提供的新功能必須在STM32CubeMX中再執行<i>產生程式碼（Generate Code）</i>。</div></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content">如果透過STM32CubeMX（而不是透過TouchGFX Designer）來執行為現有的TouchGFX專案升級X-CUBE-TOUCHGFX，TouchGFX Generator參數將被重置為預設值。</div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件頁面導航"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.20/zh-TW/docs/development/touchgfx-hal-development/touchgfx-architecture"><div class="pagination-nav__sublabel">上一個</div><div class="pagination-nav__label">抽象層架構</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.20/zh-TW/docs/category/scenarios"><div class="pagination-nav__sublabel">下一個</div><div class="pagination-nav__label">Scenarios</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enabling-touchgfx-generator" class="table-of-contents__link toc-highlight">啟用TouchGFX Generator</a></li><li><a href="#generated-code-architecture" class="table-of-contents__link toc-highlight">產生程式碼的架構</a></li><li><a href="#feature-overview" class="table-of-contents__link toc-highlight">特性概述</a></li><li><a href="#display" class="table-of-contents__link toc-highlight">顯示（Display）</a><ul><li><a href="#interface-and-dimensions" class="table-of-contents__link toc-highlight">介面與尺寸</a></li><li><a href="#framebuffer-pixel-format" class="table-of-contents__link toc-highlight">影像緩衝區像素格式</a></li><li><a href="#buffering-strategies" class="table-of-contents__link toc-highlight">緩衝區策略</a></li></ul></li><li><a href="#driver" class="table-of-contents__link toc-highlight">驅動程式</a><ul><li><a href="#application-tick-source" class="table-of-contents__link toc-highlight">應用時標源（Application Tick Source）</a></li><li><a href="#graphics-accelerator" class="table-of-contents__link toc-highlight">圖形加速器</a></li><li><a href="#real-time-operating-system" class="table-of-contents__link toc-highlight">即時作業系統</a></li><li><a href="#additional-features" class="table-of-contents__link toc-highlight">額外功能</a></li></ul></li><li><a href="#video-decoding" class="table-of-contents__link toc-highlight">影片解碼</a><ul><li><a href="#video-decoding-type" class="table-of-contents__link toc-highlight">類型</a></li><li><a href="#video-decoding-number" class="table-of-contents__link toc-highlight">併發影片</a></li><li><a href="#video-decoding-strategy" class="table-of-contents__link toc-highlight">策略</a></li><li><a href="#decode-format" class="table-of-contents__link toc-highlight">解碼格式</a></li><li><a href="#video-decoding-buffer-size" class="table-of-contents__link toc-highlight">緩衝區大小：</a></li></ul></li><li><a href="#generated-project" class="table-of-contents__link toc-highlight">產生的專案</a></li><li><a href="#touchgfx-designer-project" class="table-of-contents__link toc-highlight">TouchGFX Designer專案</a></li><li><a href="#modifying-generated-behavior" class="table-of-contents__link toc-highlight">修改所產生的行為</a></li><li><a href="#upgrading-projects" class="table-of-contents__link toc-highlight">升級專案</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2022 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div></div>
<script src="/4.20/zh-TW/assets/js/runtime~main.eb896db1.js"></script>
<script src="/4.20/zh-TW/assets/js/main.817e2aa6.js"></script>
</body>
</html>